package net.supercraftalex.liquido.modules.impl.Exploits;

import org.lwjgl.input.Keyboard;

import com.darkmagician6.eventapi.EventManager;
import com.darkmagician6.eventapi.EventTarget;

import net.minecraft.client.entity.EntityPlayerSP;
import net.minecraft.init.Blocks;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.util.BlockPos;
import net.supercraftalex.liquido.Booleans;
import net.supercraftalex.liquido.events.EventUpdate;
import net.supercraftalex.liquido.modules.Category;
import net.supercraftalex.liquido.modules.Module;
import net.supercraftalex.liquido.utils.PacketUtils;

public class BackBug extends Module{

	public BackBug() {
		super("backbug", "BackBug", Keyboard.KEY_NONE, Category.EXPLOITS);
	}
	
	double lastX = 0.0;
	double lastY = 0.0;
	double lastZ = 0.0;
	
	@EventTarget
	public void onUpdate(EventUpdate event) {
		if(mc.thePlayer.onGround && getDistanceToGround() <= 2) {
			lastX = mc.thePlayer.posX;
			lastY = mc.thePlayer.posY;
			lastZ = mc.thePlayer.posZ;
		}
		if (getDistanceToGround() >= 80 && (lastY - mc.thePlayer.posY >= 5) && (!mc.thePlayer.onGround) && (!mc.playerController.isSpectator())) {
			mc.thePlayer.setPosition(lastX, lastY, lastZ);
		}
	}
	
	@Override
	public void onEnable() {
		EventManager.register(this);
		lastX = 0.0;
		lastY = 0.0;
		lastZ = 0.0;
	}
	
	@Override
	public void onDisable() {
		EventManager.unregister(this);
	}
	
    public double getDistanceToGround() {
        double d = 0.0D;
        for (int i = 0; i < 256; i++) {
            BlockPos localBlockPos = new BlockPos(this.mc.thePlayer.posX, this.mc.thePlayer.posY - i, this.mc.thePlayer.posZ);
            if ((this.mc.theWorld.getBlockState(localBlockPos).getBlock() != Blocks.air) && (this.mc.theWorld.getBlockState(localBlockPos).getBlock() != Blocks.grass) && (this.mc.theWorld.getBlockState(localBlockPos).getBlock() != Blocks.tallgrass) && (this.mc.theWorld.getBlockState(localBlockPos).getBlock() != Blocks.red_flower) && (this.mc.theWorld.getBlockState(localBlockPos).getBlock() != Blocks.yellow_flower)) {
                d = this.mc.thePlayer.posY - localBlockPos.getY();
                return d - 1.0D;
            }
        }
        return 256.0D;
    }
	
}